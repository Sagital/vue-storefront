name: Publish

on:
  push:
    tags:
      # Matches stable and pre-releases
      - "[0-9]+.[0-9]+.[0-9]+*"
    branches:
      - saleor*
      - cablu/**

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v1
      - name: Setup node
        uses: actions/setup-node@v1
        with:
          node-version: "12.x"
      - name: Build and publish docker image
        uses: elgohr/Publish-Docker-Github-Action@master
        with:
          name: registry.sagital.ro/vue-storefront:${{ github.sha }}
          registry: registry.sagital.ro
          username: ${{ secrets.AGITAL_REGISTRY_PASSWORD }}
          password: ${{ secrets.SAGITAL_REGISTRY_USERNAME }}
          dockerfile: dev/docker/Dockerfile
          buildoptions: "--compress"
